<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å‘å¸ƒæ±‚åŠ© - æ ¡å›­äº’åŠ©å¹³å°</title>
    <link rel="stylesheet" href="style.css">
    <!-- <style>
        body { margin: 0; font-family: 'Segoe UI', sans-serif; background-color: #f5f7fa; }
        .navbar { background-color: white; padding: 0 20px; height: 60px; display: flex; align-items: center; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        .back-link { text-decoration: none; color: #666; font-size: 14px; display: flex; align-items: center; }
        .back-link:hover { color: #2196F3; }
        
        .container { max-width: 600px; margin: 30px auto; background: white; padding: 40px; border-radius: 12px; box-shadow: 0 4px 12px rgba(0,0,0,0.05); }
        h2 { margin-top: 0; color: #333; text-align: center; margin-bottom: 30px; }
        
        .form-group { margin-bottom: 20px; }
        label { display: block; margin-bottom: 8px; color: #555; font-weight: 500; }
        input, textarea { width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 6px; box-sizing: border-box; font-family: inherit; transition: 0.2s; }
        input:focus, textarea:focus { border-color: #2196F3; outline: none; }
        textarea { height: 120px; resize: vertical; }
        
        .btn-submit { width: 100%; padding: 14px; background-color: #2196F3; color: white; border: none; border-radius: 6px; font-size: 16px; font-weight: bold; cursor: pointer; transition: 0.2s; margin-top: 10px; }
        .btn-submit:hover { background-color: #1976D2; }
        
        .tips { background: #e3f2fd; color: #0d47a1; padding: 10px; border-radius: 4px; font-size: 13px; margin-bottom: 20px; }
    </style> -->
</head>
<body>
    
    <div class="navbar">
        <a href="index.html" class="back-link">â† è¿”å›å¤§å…</a>
    </div>

    <div class="container">
        <h2>å‘å¸ƒæ–°æ±‚åŠ©</h2>
        
        <div class="tips">
            ğŸ’¡ æç¤ºï¼šå‘å¸ƒæ±‚åŠ©å°†æš‚æ—¶æ‰£é™¤å¯¹åº”ç§¯åˆ†ï¼Œä»»åŠ¡å®Œæˆåç§¯åˆ†å°†è½¬ç»™å¸®åŠ©è€…ã€‚
        </div>

        <div class="form-group">
            <label>æ ‡é¢˜ (ç®€æ˜æ‰¼è¦)</label>
            <input type="text" id="title" placeholder="ä¾‹å¦‚ï¼šå›¾ä¹¦é¦†å åº§ã€å¸®å¿™å–å¿«é€’">
        </div>

        <div class="form-group">
            <label>è¯¦ç»†æè¿°</label>
            <textarea id="content" placeholder="è¯·è¯¦ç»†æè¿°ä½ çš„éœ€æ±‚..."></textarea>
        </div>

        <div class="form-group">
            <label>åœ°ç‚¹</label>
            <input type="text" id="location" placeholder="ä¾‹å¦‚ï¼šç¬¬äºŒæ•™å­¦æ¥¼ 305">
        </div>

        <div class="form-group">
            <label>æ—¶é—´è¦æ±‚</label>
            <input type="text" id="eventTime" placeholder="ä¾‹å¦‚ï¼šä»Šå¤©ä¸‹åˆ 3 ç‚¹å‰">
        </div>



        <div class="form-group">
            <label>æ·»åŠ æ ‡ç­¾ (é€‰å¡«)</label>
            <input type="text" id="tags" placeholder="ä¾‹å¦‚ï¼šè·‘è…¿ å–å¿«é€’ (ç”¨ç©ºæ ¼æˆ–é€—å·åˆ†éš”)">
        </div>

        <div class="form-group">
            <label>æ‚¬èµç§¯åˆ†</label>
            <input type="number" id="rewardPoints" placeholder="è¾“å…¥æ•´æ•°ï¼Œä¾‹å¦‚ 20">
        </div>

        <div class="container container-box">
        <h2 style="text-align: center; margin-bottom: 30px;">âœ¨ å‘å¸ƒæ–°æ±‚åŠ©</h2>
        <button class="btn-submit" onclick="submitTask()" style="width:100%; margin-top:10px;">ç«‹å³å‘å¸ƒ</button>

        <!-- <button class="btn-submit" onclick="submitTask()">ç«‹å³å‘å¸ƒ</button> -->
    </div>

    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

    <script src="config.js"></script>
    <script>
        // æ£€æŸ¥ç™»å½•çŠ¶æ€
        window.onload = function() {
            if (!localStorage.getItem('user_token')) {
                alert("è¯·å…ˆç™»å½•");
                window.location.href = 'login.html';
            }
        }

        async function submitTask() {
            // 1. è·å–è¡¨å•æ•°æ®
            const title = document.getElementById('title').value;
            const content = document.getElementById('content').value;
            const location = document.getElementById('location').value;
            const eventTime = document.getElementById('eventTime').value;
            const rewardPoints = document.getElementById('rewardPoints').value;

            // 2. ç®€å•æ ¡éªŒ
            if (!title || !content || !rewardPoints) {
                alert("è¯·å®Œæ•´å¡«å†™æ ‡é¢˜ã€å†…å®¹å’Œæ‚¬èµç§¯åˆ†");
                return;
            }

            // ğŸ‘‡ 1. è·å–æ ‡ç­¾å†…å®¹
            let tagsRaw = document.getElementById('tags').value;
            // ç®€å•å¤„ç†ï¼šæŠŠä¸­æ–‡é€—å·æ¢æˆè‹±æ–‡é€—å·
            const tags = tagsRaw ? tagsRaw.replace(/[\sï¼Œ]+/g, ',') : '';

            // 3. è·å–å‘å¸ƒè€… ID
            const publisherId = localStorage.getItem('user_id');
            if (!publisherId) {
                alert("ç”¨æˆ·ä¿¡æ¯è·å–å¤±è´¥ï¼Œè¯·é‡æ–°ç™»å½•");
                window.location.href = 'login.html';
                return;
            }

            // 4. å‘é€è¯·æ±‚
            const data = {
                title,
                content,
                location,
                eventTime,
                rewardPoints: parseInt(rewardPoints), // ç¡®ä¿è½¬æˆæ•°å­—
                publisherId: parseInt(publisherId),
                tags: tags // ğŸ‘ˆ 2. åˆ«å¿˜äº†æŠŠ tags æ”¾è¿› data é‡Œä¼ ç»™åç«¯
            };

            // ... å‰é¢çš„ä»£ç ä¸å˜ ...
            const res = await request('/tasks', 'POST', data);

            if (res && res.code === 200) {
                // âœ… ç¾åŒ–å‘å¸ƒæˆåŠŸ
                await Swal.fire({
                    icon: 'success',
                    title: 'å‘å¸ƒæˆåŠŸ',
                    text: 'æ­£åœ¨è·³è½¬å›å¤§å…...',
                    timer: 1500,
                    showConfirmButton: false
                });
                window.location.href = 'index.html'; 
            } else {
                // âŒ ç¾åŒ–å¤±è´¥
                Swal.fire({
                    icon: 'error',
                    title: 'å‘å¸ƒå¤±è´¥',
                    text: res ? res.msg : "ç§¯åˆ†ä¸è¶³æˆ–ç³»ç»Ÿé”™è¯¯"
                });
            }
        }
    </script>
</body>
</html>