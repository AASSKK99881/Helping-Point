<!DOCTYPE html>
<html lang="zh">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç™»å½• - æ ¡å›­äº’åŠ©å¹³å°</title>
    <link rel="stylesheet" href="style.css">
    <style>
/*         body {
            font-family: sans-serif;
            background: #f0f2f5;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
        }

        .box {
            background: white;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
            width: 300px;
        }

        h2 {
            text-align: center;
            color: #333;
        }

        input {
            width: 100%;
            padding: 10px;
            margin: 10px 0;
            border: 1px solid #ddd;
            border-radius: 4px;
            box-sizing: border-box;
        }

        button {
            width: 100%;
            padding: 10px;
            background: #2196F3;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            margin-top: 10px;
        }

        button.secondary {
            background: #4CAF50;
            margin-top: 10px;
        }

        .toggle-text {
            text-align: center;
            margin-top: 15px;
            font-size: 14px;
            color: #666;
            cursor: pointer;
            text-decoration: underline;
        } */
         /* ç™»å½•é¡µç‹¬æœ‰çš„æ ·å¼ */
        body.login-page {
            /* åŠ ä¸€ä¸ªæŸ”å’Œçš„æ¸å˜èƒŒæ™¯ */
            background: linear-gradient(135deg, #e0eae4 0%, #f4f7f6 100%);
            display: flex; justify-content: center; align-items: center; height: 100vh;
        }
        .login-box { width: 360px; padding: 40px; text-align: center; }
        .login-title { font-size: 24px; margin-bottom: 30px; color: var(--text-dark); }
        .toggle-text { margin-top: 20px; color: var(--primary-color); cursor: pointer; font-weight: 600; }
        .toggle-text:hover { text-decoration: underline; }
    </style>
</head>

<body class="login-page"> <div class="box login-box"> <h2 id="title" class="login-title">ğŸ‰ æ¬¢è¿å›åˆ°æ ¡å›­äº’åŠ©</h2>
        <input type="text" id="username" placeholder="è¯·è¾“å…¥ç”¨æˆ·å">
        <input type="password" id="password" placeholder="è¯·è¾“å…¥å¯†ç ">
        <button id="btn-submit" class="btn-submit" onclick="handleLogin()" style="width:100%; margin-top: 20px;">ç™»å½•</button>
        <div class="toggle-text" onclick="toggleMode()">æ²¡æœ‰è´¦å·ï¼Ÿç‚¹æ­¤æ³¨å†Œ</div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

    <script src="config.js"></script>

    <script>
        let isLoginMode = true; // å½“å‰æ˜¯å¦æ˜¯ç™»å½•æ¨¡å¼

        // åˆ‡æ¢ ç™»å½•/æ³¨å†Œ æ¨¡å¼
        function toggleMode() {
            isLoginMode = !isLoginMode;
            const title = document.getElementById('title');
            const btn = document.getElementById('btn-submit');
            const toggle = document.querySelector('.toggle-text');

            if (isLoginMode) {
                title.innerText = "ç”¨æˆ·ç™»å½•";
                btn.innerText = "ç™»å½•";
                btn.style.background = "#2196F3"; // è“è‰²
                toggle.innerText = "æ²¡æœ‰è´¦å·ï¼Ÿç‚¹æ­¤æ³¨å†Œ";
            } else {
                title.innerText = "æ–°ç”¨æˆ·æ³¨å†Œ";
                btn.innerText = "æ³¨å†Œ";
                btn.style.background = "#4CAF50"; // ç»¿è‰²
                toggle.innerText = "å·²æœ‰è´¦å·ï¼Ÿå»ç™»å½•";
            }
        }

        // å¤„ç†ç‚¹å‡»äº‹ä»¶
        async function handleLogin() {
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;

            if (!username || !password) {
                // âŒ æ›¿æ¢ alert("è¯·è¾“å…¥ç”¨æˆ·åå’Œå¯†ç ");
                Swal.fire({
                    icon: 'warning',
                    title: 'æ¼å¡«å•¦',
                    text: 'è¯·è¾“å…¥ç”¨æˆ·åå’Œå¯†ç '
                });
                return;
            }

            if (isLoginMode) {
                // --- æ‰§è¡Œç™»å½• ---
                const res = await request('/auth/login', 'POST', { username, password });
                if (res && res.code === 200) {
                    // æ¸…é™¤æ—§IDï¼Œä¿å­˜Token
                    localStorage.removeItem('user_id');
                    localStorage.setItem('user_token', res.token);
                    localStorage.setItem('username', username);

                    // âœ… æ›¿æ¢ alert("ç™»å½•æˆåŠŸï¼");
                    await Swal.fire({
                        icon: 'success',
                        title: 'æ¬¢è¿å›æ¥',
                        text: 'ç™»å½•æˆåŠŸï¼Œæ­£åœ¨è·³è½¬...',
                        timer: 1500, // 1.5ç§’åè‡ªåŠ¨å…³é—­
                        showConfirmButton: false
                    });

                    window.location.href = 'index.html';
                } else {
                    // âŒ æ›¿æ¢ alert("ç™»å½•å¤±è´¥...");
                    Swal.fire({
                        icon: 'error',
                        title: 'ç™»å½•å¤±è´¥',
                        text: res ? res.msg : 'è´¦å·æˆ–å¯†ç é”™è¯¯'
                    });
                }
            } else {
                // --- æ‰§è¡Œæ³¨å†Œ ---
                const res = await request('/auth/register', 'POST', {
                    username,
                    password,
                    role: "USER"
                });
                if (res && res.code === 200) {
                    // âœ… æ›¿æ¢ alert("æ³¨å†ŒæˆåŠŸï¼");
                    Swal.fire({
                        icon: 'success',
                        title: 'æ³¨å†ŒæˆåŠŸ',
                        text: 'å¿«å»ç™»å½•ä½“éªŒå§ï¼'
                    });
                    toggleMode();
                } else {
                    // âŒ æ›¿æ¢ alert("æ³¨å†Œå¤±è´¥...");
                    Swal.fire({
                        icon: 'error',
                        title: 'æ³¨å†Œå¤±è´¥',
                        text: res ? res.msg : 'ç”¨æˆ·åå¯èƒ½å·²å­˜åœ¨'
                    });
                }
            }
        }
    </script>
</body>

</html>